SConnect.PCSCInfo=function(){this.packageVersion="1.1.0.1";this.packageURL={win:"pcsc/pcsc-win-v"+this.packageVersion+".pkg",win64:"pcsc/pcsc-win64-v"+this.packageVersion+".pkg",lx:"pcsc/pcsc-lx-v"+this.packageVersion+".pkg",lx64:"pcsc/pcsc-lx64-v"+this.packageVersion+".pkg",osx:"pcsc/pcsc-osx-v"+this.packageVersion+".pkg"};this.packageUUID="f7384f20-cd95-11e2-8b8b-0800200c9a66";this.packageName="PCSC AddOn"};function SCardScope(){}SCardScope.User=0;SCardScope.Terminal=1;SCardScope.System=2;function SCardAccessMode(){}SCardAccessMode.Exclusive=1;SCardAccessMode.Shared=2;SCardAccessMode.Direct=3;function SCardProtocolIdentifiers(){}SCardProtocolIdentifiers.Default=-2147483648;SCardProtocolIdentifiers.Optimal=0;SCardProtocolIdentifiers.Raw=65536;SCardProtocolIdentifiers.T0=1;SCardProtocolIdentifiers.T1=2;SCardProtocolIdentifiers.Undefined=0;function SCardDisposition(){}SCardDisposition.LeaveCard=0;SCardDisposition.ResetCard=1;SCardDisposition.UnpowerCard=2;SCardDisposition.EjectCard=3;SCardDisposition.Confiscate=4;function SCardState(){}SCardState.Unaware=0;SCardState.Ignore=1;SCardState.Changed=2;SCardState.Unknown=4;SCardState.Unavailable=8;SCardState.Empty=16;SCardState.Present=32;SCardState.ATRMatch=64;SCardState.Exclusive=128;SCardState.Inuse=256;SCardState.Mute=512;SCardState.Unpowered=1024;SConnect.PCSC=function(){this._addonInfo=null;this._addonId=null;this._eContext=false;this._isDisposed=true;this._transactionCounter=0;this._connectedReader=null;this._activeProtocol=0;this._exchangeInProgress=false};SConnect.PCSC.prototype={_triggerCallback:function(e,d,c,b,a){SConnect._triggerCallback(e,d,c,b,a)},_invoke:function(c,b,e){if(typeof(b)=="undefined"){b=null}if(typeof(e)=="undefined"){e=null}var d=this;var a={success:function(f){var g=f[0];var h=(g==0);if(h){d._triggerCallback(e,true,f[1],f[2],f[3])}else{d._triggerCallback(e,false,g)}},error:function(f){d._triggerCallback(e,false,f)}};SConnect._invokeAddOnInstance(this._addonId,c,JSON.stringify(b),a)},_create:function(a){SConnect._createAddOnInstance(this._addonInfo.packageUUID,this._addonInfo.packageVersion,this._addonInfo.versionType,a)},_dispose:function(a){SConnect._disposeAddOnInstance(this._addonId,this._addonInfo.packageUUID,this._addonInfo.packageVersion,a)},_registerCardStatusChangeListener:function(a,b){SConnect._registerAddOnEvent(this._addonId,"CardStatusChangeEvent",a,b)},_unregisterCardStatusChangeListener:function(a){SConnect._unregisterAddOnEvent(this._addonId,"CardStatusChangeEvent",a)},_getActivePCI:function(){var a;if(this._activeProtocol==SCardProtocolIdentifiers.T0){a=0}else{if(this._activeProtocol==SCardProtocolIdentifiers.T1){a=1}else{if(this._activeProtocol==SCardProtocolIdentifiers.Raw){a=2}else{a=0}}}return a},getConnectedReader:function(){return this._connectedReader},getActiveProtocol:function(){return this._activeProtocol},establishContext:function(e,a){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._eContext){throw new SConnect.Exception("InvalidOperation")}if(typeof(a)=="undefined"){a=SCardScope.User}var c=[];c.push(a);var d=this;var b={success:function(){d._eContext=true;d._triggerCallback(e,true)},error:function(f){d._triggerCallback(e,false,f)}};this._invoke("SCardEstablishContext",c,b)},releaseContext:function(c){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(!this._eContext){throw new SConnect.Exception("InvalidOperation")}var b=this;var a={success:function(){b._eContext=false;b._triggerCallback(c,true)},error:function(d){b._triggerCallback(c,false,d)}};this._invoke("SCardReleaseContext",null,a)},beginTransaction:function(c){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader===null){throw new SConnect.Exception("InvalidOperation")}if(this._transactionCounter==0){var b=this;var a={success:function(){b._transactionCounter++;b._triggerCallback(c,true,b._transactionCounter)},error:function(d){b._triggerCallback(c,false,d)}};this._invoke("SCardBeginTransaction",null,a)}else{this._transactionCounter++;this._triggerCallback(c,true,this._transactionCounter)}},endTransaction:function(e,b){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if((this._connectedReader===null)||(this._transactionCounter===0)){throw new SConnect.Exception("InvalidOperation")}if(typeof(b)=="undefined"){b=SCardDisposition.LeaveCard}if(this._transactionCounter>1){this._transactionCounter--;this._triggerCallback(e,true,this._transactionCounter)}else{if(this._transactionCounter===1){var c=[];c.push(b);var d=this;var a={success:function(){d._transactionCounter=0;d._triggerCallback(e,true,d._transactionCounter)},error:function(f){d._triggerCallback(e,false,f)}};this._invoke("SCardEndTransaction",c,a)}}},cardCancel:function(a){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}this._invoke("SCardCancel",null,a)},connect:function(e,g,b,d){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader!==null){throw new SConnect.Exception("InvalidOperation")}if(arguments.length<1){throw new SConnect.Exception("InsufficientArguments")}if(typeof(b)=="undefined"){b=SCardAccessMode.Shared}if(typeof(d)=="undefined"){d=SCardProtocolIdentifiers.T0|SCardProtocolIdentifiers.T1}var c=[];c.push(e);c.push(b);c.push(d);var f=this;var a={success:function(h){f._connectedReader=e;f._activeProtocol=h;f._triggerCallback(g,true,e)},error:function(h){f._triggerCallback(g,false,h)}};this._invoke("SCardConnect",c,a)},reconnect:function(g,b,e,a){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader===null){throw new SConnect.Exception("InvalidOperation")}if(a==SCardDisposition.EjectCard){throw new SConnect.Exception("InvalidDispositionMode")}if(typeof(b)=="undefined"){b=SCardAccessMode.Shared}if(typeof(e)=="undefined"){e=SCardProtocolIdentifiers.T0|SCardProtocolIdentifiers.T1}if(typeof(a)=="undefined"){a=SCardDisposition.LeaveCard}var d=[];d.push(b);d.push(e);d.push(a);var f=this;var c={success:function(h){f._activeProtocol=h;f._triggerCallback(g,true,f._connectedReader)},error:function(h){f._triggerCallback(g,false,h)}};this._invoke("SCardReconnect",d,c)},disconnect:function(e,a){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader===null){throw new SConnect.Exception("InvalidOperation")}if(typeof(a)=="undefined"){a=SCardDisposition.LeaveCard}var c=[];c.push(a);var d=this;var b={success:function(){var f=d._connectedReader;d._activeProtocol=0;d._connectedReader=null;d._transactionCounter=0;d._triggerCallback(e,true,f)},error:function(f){d._triggerCallback(e,false,f)}};this._invoke("SCardDisconnect",c,b)},readerStatus:function(c,d,a){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(!this._eContext){throw new SConnect.Exception("InvalidOperation")}if(arguments.length<1){throw new SConnect.Exception("InsufficientArguments")}if(typeof(a)=="undefined"){a=SCardState.Unaware}var b=[];b.push(0);b.push(c);b.push(a);this._invoke("SCardGetStatusChange",b,d)},cardStatus:function(a){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader==null){throw new SConnect.Exception("InvalidOperation")}this._invoke("SCardStatus",null,a)},listReaders:function(a,e){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(!this._eContext){throw new SConnect.Exception("InvalidOperation")}var c=[];c.push(a?1:0);var d=this;var b={success:function(f){var g=f.split("#");g=g.splice(0,g.length-1);d._triggerCallback(e,true,g)},error:function(f){d._triggerCallback(e,false,f)}};this._invoke("SCardListReaders",c,b)},transmit:function(a,h,b,c,e){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader===null){throw new SConnect.Exception("InvalidOperation")}if(arguments.length<1){throw new SConnect.Exception("InsufficientArguments")}var d=[];d.push(this._getActivePCI());d.push(a);d.push((b>0)?b:258);d.push((c>=0)?c:-1);d.push((e>=0)?e:-1);var g=this;var f={success:function(i){var m=i;var j="";if(m.length>4){j=m.substr(0,m.length-4)}var l=j;var k=m.substr(m.length-4,4);g._triggerCallback(h,true,k,l)},error:function(i){g._triggerCallback(h,false,i)}};this._invoke("SCardTransmit",d,f)},exchangeAPDU:function(i,k,a,h,d){if(arguments.length<1){throw new SConnect.Exception("InsufficientArguments")}if(this._exchangeInProgress){throw new SConnect.Exception("ExchangeInProgress")}var g=this;var f="";var j="";var l=null;var c={success:function(){if(l){g._triggerCallback(k,false,l)}else{g._triggerCallback(k,true,f,j)}},error:function(m){if(l){g._triggerCallback(k,false,l)}else{g._triggerCallback(k,false,m)}}};var e={success:function(m,n){var p=m.substr(0,2);var o=m.substr(2,2);f=m;j+=n;if((p=="6C")&&(!(h>=0))&&(!(d>=0))){i=i.substring(0,8)+o;g.transmit(i,e)}else{if((p=="9F")||(p=="61")){i=i.substr(0,2)+"C00000"+o;g.transmit(i,e)}else{g._exchangeInProgress=false;g.endTransaction(c)}}},error:function(m){l=m;g._exchangeInProgress=false;g.endTransaction(c)}};var b={success:function(m){if((this._activeProtocol==SCardProtocolIdentifiers.T1)&&(typeof(a)!="undefined")&&(a!=null)){i+=a}g.transmit(i,e,null,h,d)},error:function(m){g._exchangeInProgress=false;g._triggerCallback(k,false,m)}};this._exchangeInProgress=true;this.beginTransaction(b)},cardControl:function(c,a,b,f,d){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader===null){throw new SConnect.Exception("InvalidOperation")}if(arguments.length<3){throw new SConnect.Exception("InsufficientArguments")}var e=[];e.push(c);e.push(b?1:0);e.push(a?a:"");e.push((d>0)?d:258);this._invoke("SCardControl",e,f)},getAttrib:function(b,d,a){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader===null){throw new SConnect.Exception("InvalidOperation")}if(arguments.length<1){throw new SConnect.Exception("InsufficientArguments")}var c=[];c.push(b);c.push((a>0)?a:258);this._invoke("SCardGetAttrib",c,d)},setAttrib:function(b,a,d){if(this._isDisposed){throw new SConnect.Exception("ObjectDisposed")}if(this._connectedReader==null){throw new SConnect.Exception("InvalidOperation")}if(arguments.length<2){throw new SConnect.Exception("InsufficientArguments")}var c=[];c.push(b);c.push(a);this._invoke("SCardSetAttrib",c,d)},dispose:function(){if(!this._isDisposed){this._dispose(null);this._addonId=null;this._isDisposed=true}}};SConnect.PCSC.Create=function(e){var c=true;var d=new SConnect.PCSCInfo();var b=new SConnect.PCSC();b._addonInfo=d;var a={success:function(f){var g=f[0];var i=(g>=0);if(!i){b._triggerCallback(e,false,g)}else{b._addonId=f[0];b._isDisposed=false;if(!c){b._triggerCallback(e,true,b)}else{var h={success:function(){b._triggerCallback(e,true,b)},error:function(j){b._triggerCallback(e,false,j)}};b.establishContext(h)}}},error:function(f){b._triggerCallback(e,false,f)}};b._create(a)};SConnect.PCSC.RegisterCardIRHandler=function(b){if(!window.internal_ir_scom){var a={success:function(c){window.internal_ir_scom=c;window.internal_ir_callback=b;c._registerCardStatusChangeListener(SConnect.PCSC._onCardStatusChange,b)},error:function(c){SConnect._triggerCallback(b,false,c)}};SConnect.PCSC.Create(a)}else{SConnect._triggerCallback(b,true)}};SConnect.PCSC.UnregisterCardIRHandler=function(a){if(window.internal_ir_scom){window.internal_ir_scom._unregisterCardStatusChangeListener(a);window.internal_ir_scom.dispose();window.internal_ir_scom=null;window.internal_ir_callback=null}else{SConnect._triggerCallback(a,true)}};SConnect.PCSC._onCardStatusChange=function(b){var f=JSON.parse(b);var a=f[0];var c=f[1];var e=f[2];var d={};d.readerName=a;if(c==="removed"||c===0){if(window.internal_ir_callback){if(window.internal_ir_callback.onCardRemoval){if(window.internal_ir_callback.scope){window.internal_ir_callback.onCardRemoval.apply(window.internal_ir_callback.scope,[d])}else{window.internal_ir_callback.onCardRemoval(d)}}}}else{if(c==="inserted"||c===1){if((e)&&(e.length>0)){d.ATR=e;if(window.internal_ir_callback){if(window.internal_ir_callback.onCardInsertion){if(window.internal_ir_callback.scope){window.internal_ir_callback.onCardInsertion.apply(window.internal_ir_callback.scope,[d])}else{window.internal_ir_callback.onCardInsertion(d)}}}}else{if(window.internal_ir_callback){if(window.internal_ir_callback.onCardInsertionMute){if(window.internal_ir_callback.scope){window.internal_ir_callback.onCardInsertionMute.apply(window.internal_ir_callback.scope,[d])}else{window.internal_ir_callback.onCardInsertionMute(d)}}}}}else{if(c==="disconnected"||c===2){if(window.internal_ir_callback){if(window.internal_ir_callback.onReaderDisconnected){if(window.internal_ir_callback.scope){window.internal_ir_callback.onReaderDisconnected.apply(window.internal_ir_callback.scope,[d])}else{window.internal_ir_callback.onReaderDisconnected(d)}}}}else{if(c==="connected"||c===3){if(window.internal_ir_callback){if(window.internal_ir_callback.onReaderConnected){if(window.internal_ir_callback.scope){window.internal_ir_callback.onReaderConnected.apply(window.internal_ir_callback.scope,[d])}else{window.internal_ir_callback.onReaderConnected(d)}}}}}}}};